Option ExplicitDim objFso, objFolder, objWMI, objEventDim strFile, strComputer, strFolder, strFileName, strPathDim intEvent, intNumberID, intRecordNum, colLoggedEventsDim objConnection,ficheroservers,fso,ots,desc,hora,fecha_trim,dia,horas,segundos,minutos,fecha'fichero en fromato nombre maquina enterficheroservers ="C:\servidores.txt"set fso=createobject("scripting.filesystemobject")set ots=fso.opentextfile(ficheroservers) 'Cadena coneixon. con seguridad integradaSet objConnection = CreateObject("ADODB.Connection")objConnection.Open "PROVIDER=SQLOLEDB;DATA SOURCE=172.29.11.46;Integrated Security=SSPI;DATABASE=eventos" 'Comprueba la conexion'WScript.Echo objconnection.statedo while not ots.atendofstreamintEvent = 1intRecordNum = 1strComputer = ots.readlineSet objWMI = GetObject("winmgmts:" & "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")Set colLoggedEvents = objWMI.ExecQuery ("Select * from Win32_NTLogEvent" )intEvent = 1 For Each objEvent in colLoggedEvents fecha_trim = Left(objEvent.TimeGenerated, InStrRev(objEvent.TimeGenerated, ".") - 1)dia = Left(fecha_trim,8)hora = Right(fecha_trim, 6)horas = left(hora,2)segundos = right (hora,2)minutos = left(hora,4)minutos = right(minutos,2)hora = horas & ":" & minutos & ":" & segundosfecha = dia & " " & hora 'wscript.echo fechadesc = objEvent.MessageIf Not IsNull(desc) Thendesc = objEvent.Messagedesc = replace (desc,"'","")desc = Replace(Replace(desc, vbLf, ""), vbCr, "")'wscript.echo objEvent.TimeWrittenwscript.echo  fecha & "','" & objEvent.RecordNumber & "','" & desc & "','" &  objEvent.CategoryString & "','" &  objEvent.ComputerName & "','" & objEvent.EventCode & "','" &  objEvent.Type & "','" &  objEvent.SourceName & "','" &  objEvent.Logfile & "'"objConnection.execute = "Insert into reciente (date,recordnumber,eventmsg,category,computer,eventcode,eventtype,eventsource,logfile) VALUES ('" & fecha & "','" & objEvent.RecordNumber & "','" & desc & "','" &  objEvent.CategoryString & "','" &  objEvent.ComputerName & "','" & objEvent.EventCode & "','" &  objEvent.Type & "','" &  objEvent.SourceName & "','" &  objEvent.Logfile & "')"end if intRecordNum = intRecordNum +1IntEvent = intEvent +1Next loop ots.closeset ots=nothingset fso=nothingobjConnection.CloseWScript.Quit